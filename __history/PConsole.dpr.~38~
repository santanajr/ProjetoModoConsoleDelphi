program PConsole;

{$APPTYPE CONSOLE}

{$R *.res}

uses
  System.SysUtils,
  System.Generics.Collections,
  USisDos.Tela.Menu in 'USisDos.Tela.Menu.pas',
  USisDos.Tela.IMenu in 'USisDos.Tela.IMenu.pas',
  USisDos.Tela.CadastroProduto in 'USisDos.Tela.CadastroProduto.pas',
  USisDos.Model.Produto in 'USisDos.Model.Produto.pas',
  USisDos.Tela.ICadastroProduto in 'USisDos.Tela.ICadastroProduto.pas',
  USisDos.Model.Estoque in 'USisDos.Model.Estoque.pas',
  USisDos.Tela.ICadastroEstoque in 'USisDos.Tela.ICadastroEstoque.pas',
  USisDos.Tela.CadastroEstoque in 'USisDos.Tela.CadastroEstoque.pas';

var
  LOpcaoEscolhida   : string;
  LTelaProduto      : ICadastroProduto;
  LTelaEstoque      : ICadastroEstoque;

  LListaProduto     : TList<TProduto>;
  LListaEstoque     : TList<TEstoque>;

  LRespostaCadastro : string;

  procedure CriarTelas;
  begin
     LTelaProduto  := TTelaCadastroProduto.New;
     LTelaEstoque  := TCadastroEstoque.New;
  end;

  procedure CriarListaDados;
  begin
     LListaProduto := TList<TProduto>.Create();
     LListaEstoque := TList<TEstoque>.Create();
  end;

  procedure Inicializar_OpcaoEscolhida;
  begin
    LOpcaoEscolhida := '0';
  end;

  procedure RespostaCadastroNegativa;
  begin
    LRespostaCadastro := 'N';
  end;

  procedure RespostaCadastroPositiva;
  begin
    LRespostaCadastro := 'S';
  end;

  function ValidarResposaCadastro(AValorResposta : string) : Boolean;
  begin
    result := AValorResposta.ToUpper() = LRespostaCadastro.ToUpper;
  end;

  function TelaCadastroProduto : string;
  begin
    LTelaProduto.MontarTelaCadastroProduto;
    LListaProduto.Add(LTelaProduto.GetProduto);
    Result := LTelaProduto.GetOpcaoEscolhida;
  end;

  function TelaCadastroEstoque : string;
  begin
    LTelaEstoque.MontarTelaCadastroEstoque;
    LTelaEstoque.SetListaProduto(LListaProduto)
                .SetListaEstoque(LListaEstoque)
                .PesquisarProduto(TListProd)
                .GuardarEstoque.MensagemAtualizacaoEstoque.SetProdutoEncontradoNegativo;
    Result := LTelaEstoque.GetOpcaoEscolhida;
  end;

  procedure SelecionarOpcaoMenu;
  begin
    LOpcaoEscolhida := TMenuTelaDos.New
                                      .MontarMenu
                                      .EscolherOpcao
                                      .GetOpcaoEscolhida;
  end;

  procedure MensagemOpcao3;
  begin
    Writeln('Modulo ainda não desenvolvido');
  end;

  procedure MensagemOpcao4;
  begin
    Writeln('Saindo... ');
    ReadLn;
    Abort;
  end;

begin
  try
    { TODO -oUser -cConsole Main : Insert code here }
     CriarTelas;
     CriarListaDados;
     RespostaCadastroNegativa;
     Inicializar_OpcaoEscolhida;

     while ValidarResposaCadastro('N') do
     begin
       RespostaCadastroPositiva;

       case LOpcaoEscolhida[1] of
       '0' : SelecionarOpcaoMenu;

       '1' : begin
               while ValidarResposaCadastro('S') do
                 LRespostaCadastro := TelaCadastroProduto;
             end;

       '2' : begin
               while ValidarResposaCadastro('S') do
                 LRespostaCadastro := TelaCadastroEstoque;
             end;

        '3' : begin
                MensagemOpcao3;
                RespostaCadastroNegativa;
                Inicializar_OpcaoEscolhida;
              end;
        '4' : begin
                MensagemOpcao4;
              end;
       end;
     end;
     ReadLn;
  except
    on E: Exception do
      Writeln(E.ClassName, ': ', E.Message);
  end;
end.
